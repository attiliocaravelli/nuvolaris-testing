#cloud-config
apt_update: true
apt_upgrade: true
package_update: true
package_upgrade: true
package_reboot_if_required: false

users:
 # uncomment this ONLY for debugging purposes and NEVER leave this uncommented in production
 - name: root
   lock-passwd: false
   passwd: $1$SaltSalt$YhgRYajLPrYevs14poKBQ0
   ssh_authorized_keys:
    - {{ssh_authorized_key}}
 - name: ubuntu
   lock-passwd: false
   passwd: $1$SaltSalt$YhgRYajLPrYevs14poKBQ0
   ssh_authorized_keys:
    - {{ssh_authorized_key}}
 - name: nuvolaris
   sudo: ALL=(ALL) NOPASSWD:ALL
   groups: sudo
   ssh_authorized_keys:
    - "{{ssh_authorized_key}}"

runcmd:
 - snap install microk8s --classic
 - ufw allow in on cni0 && sudo ufw allow out on cni0
 - ufw default allow routed
 - microk8s start
 - microk8s status -w
bootcmd:
- echo "created"
